@model Product
@{
	ViewData["Title"] = "Thêm sản phẩm mới";
}

@* CHNhu - 20/10/2025 - Cải thiện giao diện *@
<div id="page-wrapper">
	<div class="container-fluid">
		<!-- Tiêu đề trang -->
		<div class="row">
			<div class="col-lg-12">
				<h1 class="page-header">
					<i class="fa fa-plus-circle"></i> @ViewBag.Title
				</h1>
			</div>
		</div>

		<!-- Form thêm sản phẩm -->
		<form asp-action="AddProduct" asp-controller="Product" asp-area="Admin" method="post"
			enctype="multipart/form-data">
			<div class="row">
				<!-- Cột trái - Thông tin sản phẩm -->
				<div class="col-lg-8">
					<div class="panel panel-default">
						<div class="panel-heading">
							<i class="fa fa-info-circle"></i> Thông tin sản phẩm
						</div>
						<div class="panel-body">
							<div class="row">
								<div class="col-lg-12">
									<div class="form-group">
										<label><i class="fa fa-tag"></i> Tên sản phẩm <span
												class="text-danger">*</span></label>
										<input asp-for="productId" class="form-control"
											placeholder="Nhập tên sản phẩm..." />
										<span asp-validation-for="productId" class="text-danger"></span>
									</div>
								</div>
							</div>

							<div class="row">
								<div class="col-lg-6">
									<div class="form-group">
										<label><i class="fa fa-folder"></i> Danh mục <span
												class="text-danger">*</span></label>
										<select asp-for="categoryId" class="form-control">
											<option value="">-- Chọn danh mục --</option>
											@* @foreach (var category in ViewBag.Categories as List<Category>)
											{
												<option value="@category.categoryId">@category.categoryName</option>
											} *@
										</select>
									</div>
								</div>
								<div class="col-lg-6">
									<div class="form-group">
										<label><i class="fa fa-cubes"></i> Số lượng tồn kho <span
												class="text-danger">*</span></label>
										<input asp-for="stock" class="form-control" type="number" placeholder="0" />
										<span asp-validation-for="stock" class="text-danger"></span>
									</div>
								</div>
							</div>

							<div class="row">
								<div class="col-lg-6">
									<div class="form-group">
										<label><i class="fa fa-dollar"></i> Giá bán <span
												class="text-danger">*</span></label>
										<input asp-for="price" class="form-control" type="number" step="0.01"
											placeholder="0.00" />
										<span asp-validation-for="price" class="text-danger"></span>
									</div>
								</div>
								<div class="col-lg-6">
									<div class="form-group">
										<label><i class="fa fa-percent"></i> Khuyến mãi (%)</label>
										<input asp-for="discountPercentage" class="form-control" type="number"
											step="0.01" placeholder="0.00" />
										<span asp-validation-for="discountPercentage" class="text-danger"></span>
									</div>
								</div>
							</div>

							<div class="form-group">
								<label><i class="fa fa-align-left"></i> Mô tả sản phẩm</label>
								<textarea asp-for="description" class="form-control" rows="5"
									placeholder="Nhập mô tả chi tiết về sản phẩm..."></textarea>
								<span asp-validation-for="description" class="text-danger"></span>
							</div>
						</div>
					</div>
				</div>

				<!-- Cột phải - Hình ảnh -->
				<div class="col-lg-4">
					<div class="panel panel-primary">
						<div class="panel-heading">
							<i class="fa fa-image"></i> Hình ảnh sản phẩm
						</div>
						<div class="panel-body">
							<div class="form-group">
								<label><i class="fa fa-camera"></i> Hình ảnh chính <span
										class="text-danger">*</span></label>
								<div class="text-center" style="margin-bottom: 10px;">
									<img id="preview-main-image" src="~/img/default-product.png" alt="Preview"
										class="img-thumbnail" style="max-width: 100%; max-height: 250px;">
								</div>
								<input type="file" name="HinhAnhFile" id="main-image-input" class="form-control"
									accept="image/*" />
								<p class="help-block"><small>Chọn hình ảnh đại diện cho sản phẩm</small></p>
							</div>

							<div class="form-group">
								<label><i class="fa fa-images"></i> Hình ảnh bổ sung</label>
								<input type="hidden" id="num_img" value="1">
								<div id="img_container">
									<input type="file" class="form-control" id="img_1" name="img_1" accept="image/*"
										style="margin-bottom: 10px;">
								</div>
								<button type="button" class="btn btn-info btn-block" id="btn_add_img">
									<i class="fa fa-plus"></i> Thêm hình ảnh
								</button>
							</div>
						</div>
					</div>

					<!-- Nút hành động -->
					<div class="panel panel-default">
						<div class="panel-body">
							<button type="submit" class="btn btn-success btn-block btn-lg">
								<i class="fa fa-save"></i> Lưu sản phẩm
							</button>
							<a asp-area="Admin" asp-controller="Product" asp-action="Index"
								class="btn btn-default btn-block">
								<i class="fa fa-arrow-left"></i> Quay lại
							</a>
						</div>
					</div>
				</div>
			</div>
		</form>
	</div>
</div>
@* endCHNhu *@

@* CHNhu - 20/10/2025 - Script xử lý form thêm sản phẩm *@
@section Script {
	<script>
		$(document).ready(function () {
			// Preview hình ảnh chính
			$('#main-image-input').on('change', function (e) {
				const file = e.target.files[0];
				if (file) {
					const reader = new FileReader();
					reader.onload = function (e) {
						$('#preview-main-image').attr('src', e.target.result);
					}
					reader.readAsDataURL(file);
				}
			});

			// Thêm hình ảnh bổ sung
			$('#btn_add_img').on('click', function () {
				var numImg = $('#num_img');
				var currentNum = parseInt(numImg.val()) + 1;
				numImg.val(currentNum);

				var newInput = $('<input>')
					.attr('type', 'file')
					.attr('id', 'img_' + currentNum)
					.attr('name', 'img_' + currentNum)
					.attr('accept', 'image/*')
					.addClass('form-control')
					.css('margin-bottom', '10px');

				$('#img_container').append(newInput);
			});

			// Validation form
			$('form').on('submit', function (e) {
				var isValid = true;
				var errors = [];

				if (!$('[name="productId"]').val().trim()) {
					errors.push('Tên sản phẩm');
					isValid = false;
				}
				if (!$('[name="categoryId"]').val()) {
					errors.push('Danh mục');
					isValid = false;
				}
				if (!$('[name="price"]').val() || parseFloat($('[name="price"]').val()) <= 0) {
					errors.push('Giá bán');
					isValid = false;
				}
				if (!$('[name="stock"]').val() || parseInt($('[name="stock"]').val()) < 0) {
					errors.push('Số lượng tồn kho');
					isValid = false;
				}

				if (!isValid) {
					e.preventDefault();
					alert('Vui lòng điền đầy đủ thông tin:\n- ' + errors.join('\n- '));
					return false;
				}
			});
		});
	</script>
}
@* endCHNhu *@
